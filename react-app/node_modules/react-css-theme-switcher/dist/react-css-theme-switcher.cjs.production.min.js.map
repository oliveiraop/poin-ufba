{"version":3,"file":"react-css-theme-switcher.cjs.production.min.js","sources":["../src/index.tsx","../src/utils.ts"],"sourcesContent":["import * as React from 'react';\nimport { findCommentNode, arrayToObject, createLinkElement } from './utils';\n\nenum Status {\n  idle = 'idle',\n  loading = 'loading',\n  loaded = 'loaded',\n}\n\ninterface IThemeSwitcherContext {\n  currentTheme: string | undefined;\n  themes: Record<any, string>;\n  switcher: ({ theme }: { theme: string }) => void;\n  status: Status;\n}\n\nconst ThemeSwitcherContext = React.createContext<\n  IThemeSwitcherContext | undefined\n>(undefined);\n\ninterface Props {\n  themeMap: Record<any, string>;\n  children?: React.ReactNode;\n  insertionPoint?: string;\n  id?: string;\n  defaultTheme?: string;\n  attr?: string;\n}\n\nexport function ThemeSwitcherProvider({\n  themeMap,\n  insertionPoint,\n  defaultTheme,\n  id = 'current-theme-style',\n  attr = 'data-theme',\n  ...rest\n}: Props) {\n  const [status, setStatus] = React.useState<Status>(Status.idle);\n  const [currentTheme, setCurrentTheme] = React.useState<string>();\n\n  const insertStyle = React.useCallback(\n    (linkElement: HTMLElement): HTMLElement | void => {\n      if (insertionPoint) {\n        const insertionPointElement = findCommentNode(insertionPoint);\n\n        if (!insertionPointElement) {\n          console.warn(\n            `Insertion point '${insertionPoint}' does not exist. Be sure to add comment on head and that it matches the insertionPoint`\n          );\n          return document.head.appendChild(linkElement);\n        }\n\n        const { parentNode } = insertionPointElement;\n        if (parentNode) {\n          return parentNode.insertBefore(\n            linkElement,\n            insertionPointElement.nextSibling\n          );\n        }\n      } else {\n        return document.head.appendChild(linkElement);\n      }\n    },\n    [insertionPoint]\n  );\n\n  const switcher = React.useCallback(\n    ({ theme }: { theme: string }) => {\n      if (theme === currentTheme) return;\n\n      const previousStyle = document.getElementById(id);\n      if (previousStyle) {\n        previousStyle.remove();\n      }\n\n      if (themeMap[theme]) {\n        setStatus(Status.loading);\n\n        const linkElement = createLinkElement({\n          type: 'text/css',\n          rel: 'stylesheet',\n          id: id,\n          href: themeMap[theme],\n          onload: () => {\n            setStatus(Status.loaded);\n          },\n        });\n\n        insertStyle(linkElement);\n        setCurrentTheme(theme);\n      } else {\n        return console.warn('Could not find specified theme');\n      }\n\n      document.body.setAttribute(attr, theme);\n    },\n    [themeMap, insertStyle, attr, id, currentTheme]\n  );\n\n  React.useEffect(() => {\n    if (defaultTheme) {\n      switcher({ theme: defaultTheme });\n    }\n  }, [defaultTheme]);\n\n  React.useEffect(() => {\n    const themes = Object.keys(themeMap);\n\n    themes.map(theme => {\n      const themeAssetId = `theme-prefetch-${theme}`;\n      if (!document.getElementById(themeAssetId)) {\n        const stylePrefetch = document.createElement('link');\n        stylePrefetch.rel = 'prefetch';\n        stylePrefetch.type = 'text/css';\n        stylePrefetch.id = themeAssetId;\n        stylePrefetch.href = themeMap[theme];\n\n        insertStyle(stylePrefetch);\n      }\n      return '';\n    });\n  }, [themeMap, insertStyle]);\n\n  const value = React.useMemo(\n    () => ({\n      switcher,\n      status,\n      currentTheme,\n      themes: arrayToObject(Object.keys(themeMap)),\n    }),\n    [switcher, status, currentTheme, themeMap]\n  );\n\n  return <ThemeSwitcherContext.Provider value={value} {...rest} />;\n}\n\nexport function useThemeSwitcher() {\n  const context = React.useContext(ThemeSwitcherContext);\n  if (!context) {\n    throw new Error(\n      'To use `useThemeSwitcher`, component must be within a ThemeSwitcherProvider'\n    );\n  }\n  return context;\n}\n","export function findCommentNode(comment: string) {\n  const head = document.head;\n  for (let i = 0; i < head.childNodes.length; i++) {\n    const node = head.childNodes[i];\n    if (node.nodeType === 8 && node?.nodeValue?.trim() === comment) {\n      return node;\n    }\n  }\n  return null;\n}\n\nexport function arrayToObject(array: string[]): Record<any, string> {\n  const obj: Record<any, string> = {};\n  array.forEach(el => (obj[el] = el));\n  return obj;\n}\n\nexport function createLinkElement(attributes: Record<string, any>) {\n  const linkElement = document.createElement('link');\n\n  for (const [attribute, value] of Object.entries(attributes)) {\n    if (attribute === 'onload') {\n      linkElement.onload = attributes.onload;\n      continue;\n    }\n\n    // @ts-ignore\n    linkElement[attribute] = value;\n  }\n\n  return linkElement;\n}\n"],"names":["Status","ThemeSwitcherContext","React","undefined","themeMap","insertionPoint","defaultTheme","id","attr","rest","idle","status","setStatus","currentTheme","setCurrentTheme","insertStyle","linkElement","document","head","appendChild","insertionPointElement","comment","i","childNodes","length","node","nodeType","nodeValue","trim","findCommentNode","console","warn","parentNode","insertBefore","nextSibling","switcher","theme","previousStyle","getElementById","remove","loading","attributes","createElement","Object","entries","attribute","onload","createLinkElement","type","rel","href","loaded","body","setAttribute","keys","map","themeAssetId","stylePrefetch","value","themes","array","obj","forEach","el","Provider","context","Error"],"mappings":"wEAGKA,sBAAL,SAAKA,GACHA,cACAA,oBACAA,kBAHF,CAAKA,IAAAA,OAaL,IAAMC,EAAuBC,qBAE3BC,iDAYAC,IAAAA,SACAC,IAAAA,eACAC,IAAAA,iBACAC,GAAAA,aAAK,4BACLC,KAAAA,aAAO,eACJC,mMAEyBP,WAAuBF,EAAOU,MAAnDC,OAAQC,SACyBV,aAAjCW,OAAcC,OAEfC,EAAcb,eAClB,SAACc,OACKX,SAkBKY,SAASC,KAAKC,YAAYH,OAjB3BI,WC3CkBC,WACxBH,EAAOD,SAASC,KACbI,EAAI,EAAGA,EAAIJ,EAAKK,WAAWC,OAAQF,IAAK,OACzCG,EAAOP,EAAKK,WAAWD,MACP,IAAlBG,EAAKC,WAAkBD,MAAAA,aAAAA,EAAME,gCAAWC,UAAWP,SAC9CI,SAGJ,KDmC6BI,CAAgBxB,OAEzCe,SACHU,QAAQC,yBACc1B,6FAEfY,SAASC,KAAKC,YAAYH,OAG3BgB,EAAeZ,EAAfY,kBACJA,EACKA,EAAWC,aAChBjB,EACAI,EAAsBc,sBAO9B,CAAC7B,IAGG8B,EAAWjC,eACf,gBAAGkC,IAAAA,SACGA,IAAUvB,OAERwB,EAAgBpB,SAASqB,eAAe/B,MAC1C8B,GACFA,EAAcE,UAGZnC,EAASgC,UAgBJN,QAAQC,KAAK,kCAfpBnB,EAAUZ,EAAOwC,aAEXxB,WC7DoByB,WAC1BzB,EAAcC,SAASyB,cAAc,cAEVC,OAAOC,QAAQH,kBAAa,YAAjDI,OACQ,WAAdA,EAMJ7B,EAAY6B,QALV7B,EAAY8B,OAASL,EAAWK,cAQ7B9B,EDgDmB+B,CAAkB,CACpCC,KAAM,WACNC,IAAK,aACL1C,GAAIA,EACJ2C,KAAM9C,EAASgC,GACfU,OAAQ,WACNlC,EAAUZ,EAAOmD,WAIrBpC,EAAYC,GACZF,EAAgBsB,GAKlBnB,SAASmC,KAAKC,aAAa7C,EAAM4B,MAEnC,CAAChC,EAAUW,EAAaP,EAAMD,EAAIM,IAGpCX,aAAgB,WACVI,GACF6B,EAAS,CAAEC,MAAO9B,MAEnB,CAACA,IAEJJ,aAAgB,WACCyC,OAAOW,KAAKlD,GAEpBmD,KAAI,SAAAnB,OACHoB,oBAAiCpB,MAClCnB,SAASqB,eAAekB,GAAe,KACpCC,EAAgBxC,SAASyB,cAAc,QAC7Ce,EAAcR,IAAM,WACpBQ,EAAcT,KAAO,WACrBS,EAAclD,GAAKiD,EACnBC,EAAcP,KAAO9C,EAASgC,GAE9BrB,EAAY0C,SAEP,QAER,CAACrD,EAAUW,QAER2C,EAAQxD,WACZ,iBAAO,CACLiC,SAAAA,EACAxB,OAAAA,EACAE,aAAAA,EACA8C,QCrHwBC,EDqHFjB,OAAOW,KAAKlD,GCpHhCyD,EAA2B,GACjCD,EAAME,SAAQ,SAAAC,UAAOF,EAAIE,GAAMA,KACxBF,QAHqBD,EACtBC,IDsHJ,CAAC1B,EAAUxB,EAAQE,EAAcT,WAG5BF,gBAACD,EAAqB+D,wBAASN,MAAOA,GAAWjD,8BAG1D,eACQwD,EAAU/D,aAAiBD,OAC5BgE,QACG,IAAIC,MACR,sFAGGD"}