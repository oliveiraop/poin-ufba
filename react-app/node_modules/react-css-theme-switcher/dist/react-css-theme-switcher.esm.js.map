{"version":3,"file":"react-css-theme-switcher.esm.js","sources":["../src/utils.ts","../src/index.tsx"],"sourcesContent":["export function findCommentNode(comment: string) {\n  const head = document.head;\n  for (let i = 0; i < head.childNodes.length; i++) {\n    const node = head.childNodes[i];\n    if (node.nodeType === 8 && node?.nodeValue?.trim() === comment) {\n      return node;\n    }\n  }\n  return null;\n}\n\nexport function arrayToObject(array: string[]): Record<any, string> {\n  const obj: Record<any, string> = {};\n  array.forEach(el => (obj[el] = el));\n  return obj;\n}\n\nexport function createLinkElement(attributes: Record<string, any>) {\n  const linkElement = document.createElement('link');\n\n  for (const [attribute, value] of Object.entries(attributes)) {\n    if (attribute === 'onload') {\n      linkElement.onload = attributes.onload;\n      continue;\n    }\n\n    // @ts-ignore\n    linkElement[attribute] = value;\n  }\n\n  return linkElement;\n}\n","import * as React from 'react';\nimport { findCommentNode, arrayToObject, createLinkElement } from './utils';\n\nenum Status {\n  idle = 'idle',\n  loading = 'loading',\n  loaded = 'loaded',\n}\n\ninterface IThemeSwitcherContext {\n  currentTheme: string | undefined;\n  themes: Record<any, string>;\n  switcher: ({ theme }: { theme: string }) => void;\n  status: Status;\n}\n\nconst ThemeSwitcherContext = React.createContext<\n  IThemeSwitcherContext | undefined\n>(undefined);\n\ninterface Props {\n  themeMap: Record<any, string>;\n  children?: React.ReactNode;\n  insertionPoint?: string;\n  id?: string;\n  defaultTheme?: string;\n  attr?: string;\n}\n\nexport function ThemeSwitcherProvider({\n  themeMap,\n  insertionPoint,\n  defaultTheme,\n  id = 'current-theme-style',\n  attr = 'data-theme',\n  ...rest\n}: Props) {\n  const [status, setStatus] = React.useState<Status>(Status.idle);\n  const [currentTheme, setCurrentTheme] = React.useState<string>();\n\n  const insertStyle = React.useCallback(\n    (linkElement: HTMLElement): HTMLElement | void => {\n      if (insertionPoint) {\n        const insertionPointElement = findCommentNode(insertionPoint);\n\n        if (!insertionPointElement) {\n          console.warn(\n            `Insertion point '${insertionPoint}' does not exist. Be sure to add comment on head and that it matches the insertionPoint`\n          );\n          return document.head.appendChild(linkElement);\n        }\n\n        const { parentNode } = insertionPointElement;\n        if (parentNode) {\n          return parentNode.insertBefore(\n            linkElement,\n            insertionPointElement.nextSibling\n          );\n        }\n      } else {\n        return document.head.appendChild(linkElement);\n      }\n    },\n    [insertionPoint]\n  );\n\n  const switcher = React.useCallback(\n    ({ theme }: { theme: string }) => {\n      if (theme === currentTheme) return;\n\n      const previousStyle = document.getElementById(id);\n      if (previousStyle) {\n        previousStyle.remove();\n      }\n\n      if (themeMap[theme]) {\n        setStatus(Status.loading);\n\n        const linkElement = createLinkElement({\n          type: 'text/css',\n          rel: 'stylesheet',\n          id: id,\n          href: themeMap[theme],\n          onload: () => {\n            setStatus(Status.loaded);\n          },\n        });\n\n        insertStyle(linkElement);\n        setCurrentTheme(theme);\n      } else {\n        return console.warn('Could not find specified theme');\n      }\n\n      document.body.setAttribute(attr, theme);\n    },\n    [themeMap, insertStyle, attr, id, currentTheme]\n  );\n\n  React.useEffect(() => {\n    if (defaultTheme) {\n      switcher({ theme: defaultTheme });\n    }\n  }, [defaultTheme]);\n\n  React.useEffect(() => {\n    const themes = Object.keys(themeMap);\n\n    themes.map(theme => {\n      const themeAssetId = `theme-prefetch-${theme}`;\n      if (!document.getElementById(themeAssetId)) {\n        const stylePrefetch = document.createElement('link');\n        stylePrefetch.rel = 'prefetch';\n        stylePrefetch.type = 'text/css';\n        stylePrefetch.id = themeAssetId;\n        stylePrefetch.href = themeMap[theme];\n\n        insertStyle(stylePrefetch);\n      }\n      return '';\n    });\n  }, [themeMap, insertStyle]);\n\n  const value = React.useMemo(\n    () => ({\n      switcher,\n      status,\n      currentTheme,\n      themes: arrayToObject(Object.keys(themeMap)),\n    }),\n    [switcher, status, currentTheme, themeMap]\n  );\n\n  return <ThemeSwitcherContext.Provider value={value} {...rest} />;\n}\n\nexport function useThemeSwitcher() {\n  const context = React.useContext(ThemeSwitcherContext);\n  if (!context) {\n    throw new Error(\n      'To use `useThemeSwitcher`, component must be within a ThemeSwitcherProvider'\n    );\n  }\n  return context;\n}\n"],"names":["findCommentNode","comment","head","document","i","childNodes","length","node","nodeType","nodeValue","trim","arrayToObject","array","obj","forEach","el","createLinkElement","attributes","linkElement","createElement","Object","entries","attribute","value","onload","Status","ThemeSwitcherContext","React","undefined","ThemeSwitcherProvider","themeMap","insertionPoint","defaultTheme","id","attr","rest","idle","status","setStatus","currentTheme","setCurrentTheme","insertStyle","insertionPointElement","console","warn","appendChild","parentNode","insertBefore","nextSibling","switcher","theme","previousStyle","getElementById","remove","loading","type","rel","href","loaded","body","setAttribute","themes","keys","map","themeAssetId","stylePrefetch","Provider","useThemeSwitcher","context","Error"],"mappings":"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"}